# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ File Scanner

## üìã –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

File Scanner Service - —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö ETL-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã TIA (Telecommunications Intelligence Analytics) –¥–ª—è –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –õ–∏–±–µ—Ä–∏–∏. –°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–ª–µ–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ Orange –∏ MTN –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö ASN.1 –∏ CSV –¥–ª—è –Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —É—Å–ª—É–≥.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—å—é —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ—Ä–µ–∑ Redis
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
- –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è**: Kotlin 2.0.21
- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: Spring Boot 3.3.5
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL —Å Liquibase –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–µ—Ä–µ–¥–∏**: Redis
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á**: Quartz Scheduler
- **–ú–µ—Ç—Ä–∏–∫–∏**: Micrometer —Å Prometheus
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: OpenAPI/Swagger 2.3.0
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: JUnit 5, MockK, Testcontainers
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker —Å Testcontainers –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
services/file-scanner/
‚îú‚îÄ‚îÄ src/main/kotlin/com/quantumsoft/tia/scanner/
‚îÇ   ‚îú‚îÄ‚îÄ components/           # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DirectoryScanner  # –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FileValidator     # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ QueueManager      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—å—é Redis
‚îÇ   ‚îú‚îÄ‚îÄ config/               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OpenApiConfig     # Swagger/OpenAPI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QuartzConfig      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StartupInitializer # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
‚îÇ   ‚îú‚îÄ‚îÄ controllers/          # REST API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ actuator/         # Actuator endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ files/            # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ health/           # Health check
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jobs/             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metrics/          # –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ dto/                  # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ entities/             # JPA —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ metrics/              # –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îú‚îÄ‚îÄ models/               # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ repositories/         # JPA —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ scheduler/            # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ services/             # –ë–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å—ã
‚îî‚îÄ‚îÄ src/main/resources/
    ‚îú‚îÄ‚îÄ application.yml       # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ db/changelog/         # Liquibase –º–∏–≥—Ä–∞—Ü–∏–∏
```

## üîå API Endpoints

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/v1/scanner/jobs` | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è |
| GET | `/api/v1/scanner/jobs/{jobId}` | –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ |
| POST | `/api/v1/scanner/jobs` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É |
| PUT | `/api/v1/scanner/jobs/{jobId}` | –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É |
| DELETE | `/api/v1/scanner/jobs/{jobId}` | –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É |

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/api/v1/scanner/jobs/{jobId}/trigger` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ |
| GET | `/api/v1/scanner/jobs/{jobId}/executions` | –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –∑–∞–¥–∞—á–∏ |
| GET | `/api/v1/scanner/jobs/{jobId}/statistics` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á–∏ |

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/v1/scanner/files` | –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ |
| GET | `/api/v1/scanner/files/{fileId}` | –î–µ—Ç–∞–ª–∏ —Ñ–∞–π–ª–∞ |
| POST | `/api/v1/scanner/files/{fileId}/retry` | –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–∞–π–ª–∞ |
| DELETE | `/api/v1/scanner/files/{fileId}` | –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –æ —Ñ–∞–π–ª–µ |
| GET | `/api/v1/scanner/files/statistics` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ñ–∞–π–ª–∞–º |
| POST | `/api/v1/scanner/files/cleanup` | –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ |

### –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/v1/scanner/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞ |
| GET | `/api/v1/scanner/metrics` | –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ |
| GET | `/api/v1/scanner/metrics/summary` | –°–≤–æ–¥–∫–∞ –º–µ—Ç—Ä–∏–∫ |
| GET | `/api/v1/scanner/metrics/queue` | –ú–µ—Ç—Ä–∏–∫–∏ –æ—á–µ—Ä–µ–¥–∏ |
| GET | `/api/v1/scanner/metrics/performance` | –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |
| POST | `/api/v1/scanner/metrics/reset` | –°–±—Ä–æ—Å –º–µ—Ç—Ä–∏–∫ |

### Actuator Endpoints

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/file-scanner/actuator/health` | Spring Boot health check |
| GET | `/file-scanner/actuator/info` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ |
| GET | `/file-scanner/actuator/metrics` | –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ |
| GET | `/file-scanner/actuator/prometheus` | –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Prometheus |

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### DirectoryScanner

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º.

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:
- `scan(config: ScanConfiguration): ScanResult` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ glob-–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤
- –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –≥–ª—É–±–∏–Ω—ã
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä—É —Ñ–∞–π–ª–∞
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ SHA-256 —Ö—ç—à–∞ —Ñ–∞–π–ª–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –¢–∞–π–º–∞—É—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### QueueManager

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ Redis.

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:
- `queueFile(request: QueueRequest): QueueResult` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ –æ—á–µ—Ä–µ–¥—å
- `batchQueue(requests: List<QueueRequest>): BatchQueueResult` - –ø–∞–∫–µ—Ç–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
- `moveToDeadLetter(queueId: String, reason: String): Boolean` - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ DLQ
- `getQueueStatistics(): QueueStatistics` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏
- `cleanupExpiredLocks(): Int` - –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –ü—Ä–∏–æ—Ä–∏—Ç–µ–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (HIGH, NORMAL, LOW)
- Dead Letter Queue –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å –ø–æ–¥—Å—á–µ—Ç–æ–º –ø–æ–ø—ã—Ç–æ–∫
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏ –æ—á–µ—Ä–µ–¥–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

### JobScheduler

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ Quartz.

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:
- `scheduleJob(scanJob: ScanJob)` - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `triggerJobNow(jobId: UUID)` - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫
- `pauseJob(jobId: UUID)` - –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏
- `resumeJob(jobId: UUID)` - –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `isJobRunning(jobId: UUID): Boolean` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CRON –∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
- –ö–ª–∞—Å—Ç–µ—Ä–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —á–µ—Ä–µ–∑ Quartz JDBC JobStore
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤ (misfire handling)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞

## üì¶ –°–µ—Ä–≤–∏—Å—ã

### ScanJobService

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∑–∞–¥–∞—á —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã**:
```kotlin
- findJobs(active: Boolean?, parserId: String?, pageable: Pageable): Page<ScanJobDto>
- findById(id: UUID): ScanJobDetailDto?
- createJob(request: CreateScanJobRequest): ScanJobDto
- updateJob(id: UUID, request: UpdateScanJobRequest): ScanJobDto?
- deleteJob(id: UUID): Boolean
- triggerScan(jobId: UUID, force: Boolean): ScanExecutionDto?
- getExecutions(jobId: UUID, pageable: Pageable): Page<ScanExecutionDto>
- getJobStatistics(jobId: UUID): JobStatisticsDto?
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- ScanJobRepository - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á
- ScanJobExecutionRepository - –∏—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π
- ScannedFileRepository - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏
- JobScheduler - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º

### FileStatusService

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã**:
```kotlin
- queryFiles(filter: FileStatusFilter, pageable: Pageable): Page<FileStatusDto>
- getFile(fileId: UUID): FileStatusDto?
- retryFile(fileId: UUID): FileStatusDto?
- deleteFile(fileId: UUID): Boolean
- getStatistics(jobId: UUID?): FileStatisticsDto
- cleanup(request: CleanupRequest): CleanupResultDto
```

## üóÑÔ∏è –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

#### ScanJob
```kotlin
data class ScanJob(
    val id: UUID,
    val name: String,                    // –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –∑–∞–¥–∞—á–∏
    val description: String?,             // –û–ø–∏—Å–∞–Ω–∏–µ
    val sourceDirectory: String,         // –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    val filePattern: String,             // –ü–∞—Ç—Ç–µ—Ä–Ω —Ñ–∞–π–ª–æ–≤ (glob)
    val scanIntervalType: ScanIntervalType, // CRON –∏–ª–∏ FIXED
    val scanIntervalValue: String,       // –ó–Ω–∞—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
    val maxFileSizeMb: Int,              // –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
    val recursiveScan: Boolean,          // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    val maxDepth: Int,                   // –ú–∞–∫—Å. –≥–ª—É–±–∏–Ω–∞ —Ä–µ–∫—É—Ä—Å–∏–∏
    val priority: Int,                   // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (0-10)
    val parserId: String,                // ID –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    val isActive: Boolean,               // –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á–∏
    val createdAt: Instant,
    val updatedAt: Instant
)
```

#### ScannedFileEntity
```kotlin
data class ScannedFileEntity(
    val id: UUID,
    val scanJob: ScanJob,                // –°–≤—è–∑–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞
    val filePath: String,                // –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
    val fileName: String,                // –ò–º—è —Ñ–∞–π–ª–∞
    val fileSizeBytes: Long,             // –†–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
    val fileHash: String,                // SHA-256 —Ö—ç—à
    val fileModifiedAt: Instant,         // –î–∞—Ç–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞
    val status: FileStatus,              // –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
    val queueId: String?,                // ID –≤ –æ—á–µ—Ä–µ–¥–∏
    val parserId: String?,               // ID –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞
    val discoveredAt: Instant,           // –í—Ä–µ–º—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
    val processedAt: Instant?,          // –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    val errorMessage: String?           // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
)
```

#### ScanJobExecution
```kotlin
data class ScanJobExecution(
    val id: UUID,
    val scanJob: ScanJob,                // –°–≤—è–∑–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞
    val instanceId: String,              // ID –∏–Ω—Å—Ç–∞–Ω—Å–∞ —Å–∫–∞–Ω–µ—Ä–∞
    val status: ExecutionStatus,         // RUNNING, COMPLETED, FAILED
    val startedAt: Instant,              // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
    val completedAt: Instant?,          // –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    val filesDiscovered: Int,           // –ù–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤
    val filesQueued: Int,               // –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å
    val filesSkipped: Int,              // –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ñ–∞–π–ª–æ–≤
    val durationMs: Long?,              // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º—Å
    val errorMessage: String?           // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
)
```

### –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è (Enums)

```kotlin
enum class FileStatus {
    DISCOVERED,    // –§–∞–π–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω
    QUEUED,       // –í –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É
    PROCESSING,   // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
    COMPLETED,    // –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
    FAILED,       // –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    SKIPPED       // –ü—Ä–æ–ø—É—â–µ–Ω
}

enum class ExecutionStatus {
    RUNNING,      // –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
    COMPLETED,    // –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
    FAILED        // –ó–∞–≤–µ—Ä—à–µ–Ω–æ —Å –æ—à–∏–±–∫–æ–π
}

enum class ScanIntervalType {
    CRON,         // Cron-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ
    FIXED         // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
}

enum class Priority {
    HIGH,         // –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    NORMAL,       // –û–±—ã—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    LOW           // –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
}
```

## üîÑ –î–∏–∞–≥—Ä–∞–º–º—ã Flow

### –ü—Ä–æ—Ü–µ—Å—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

```
1. JobScheduler –∑–∞–ø—É—Å–∫–∞–µ—Ç ScannerJob –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
   ‚Üì
2. ScannerJob —Å–æ–∑–¥–∞–µ—Ç ScanJobExecution —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º RUNNING
   ‚Üì
3. DirectoryScanner –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
   ‚îú‚îÄ –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥ —Å —É—á–µ—Ç–æ–º maxDepth
   ‚îú‚îÄ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ glob-–ø–∞—Ç—Ç–µ—Ä–Ω—É
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
   ‚îî‚îÄ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ SHA-256 —Ö—ç—à–∞
   ‚Üì
4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ –ë–î –ø–æ hash
   ‚îú‚îÄ QueueManager –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ Redis –æ—á–µ—Ä–µ–¥—å
   ‚îú‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ScannedFileEntity –≤ –ë–î
   ‚Üì
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ScanJobExecution —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º COMPLETED
   ‚Üì
6. MetricsCollector –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ API –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏

```
1. POST /api/v1/scanner/jobs
   ‚Üì
2. JobsController.createJob()
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è CreateScanJobRequest
   ‚îî‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–∏
   ‚Üì
3. ScanJobService.createJob()
   ‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ ScanJob entity
   ‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL
   ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—Ç ScanJobDto
   ‚Üì
4. JobScheduler.scheduleJob()
   ‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ Quartz JobDetail
   ‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ Trigger (CRON/FIXED)
   ‚îî‚îÄ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Quartz Scheduler
   ‚Üì
5. HTTP 201 Created —Å ScanJobDto
```

### –ü—Ä–æ—Ü–µ—Å—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—å—é

```
1. QueueManager.queueFile()
   ‚Üì
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
   ‚îú‚îÄ –ö–ª—é—á: lock:{fileHash}
   ‚îú‚îÄ TTL: 5 –º–∏–Ω—É—Ç
   ‚îî‚îÄ Instance ID –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ
   ‚Üì
3. –ï—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞:
   ‚îú‚îÄ –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è QueueMessage –≤ JSON
   ‚îú‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ Redis List –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
   ‚îÇ   ‚îú‚îÄ queue:high
   ‚îÇ   ‚îú‚îÄ queue:normal
   ‚îÇ   ‚îî‚îÄ queue:low
   ‚îú‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   ‚îî‚îÄ –ó–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫
   ‚Üì
4. –í–æ–∑–≤—Ä–∞—Ç QueueResult —Å queueId
```

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```
FileScannerApplication
    ‚îú‚îÄ @EnableScheduling ‚Üí Quartz –∞–∫—Ç–∏–≤–∞—Ü–∏—è
    ‚îú‚îÄ @EnableAsync ‚Üí –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    ‚îî‚îÄ Spring Boot –∞–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        ‚îú‚îÄ JPA/Hibernate
        ‚îú‚îÄ Redis
        ‚îú‚îÄ Liquibase
        ‚îî‚îÄ Micrometer

Controllers Layer
    ‚îú‚îÄ JobsController ‚Üí ScanJobService
    ‚îú‚îÄ FilesController ‚Üí FileStatusService
    ‚îú‚îÄ MetricsController ‚Üí MetricsCollector
    ‚îî‚îÄ HealthController ‚Üí Redis, PostgreSQL checks

Service Layer
    ‚îú‚îÄ ScanJobService
    ‚îÇ   ‚îú‚îÄ ScanJobRepository
    ‚îÇ   ‚îú‚îÄ ScanJobExecutionRepository
    ‚îÇ   ‚îú‚îÄ ScannedFileRepository
    ‚îÇ   ‚îî‚îÄ JobScheduler
    ‚îî‚îÄ FileStatusService
        ‚îú‚îÄ ScannedFileRepository
        ‚îî‚îÄ QueueManager

Component Layer
    ‚îú‚îÄ DirectoryScanner
    ‚îÇ   ‚îî‚îÄ MetricsCollector
    ‚îú‚îÄ QueueManager
    ‚îÇ   ‚îú‚îÄ RedisTemplate
    ‚îÇ   ‚îú‚îÄ ObjectMapper
    ‚îÇ   ‚îî‚îÄ MetricsCollector
    ‚îî‚îÄ FileValidator

Scheduler Layer
    ‚îú‚îÄ JobScheduler
    ‚îÇ   ‚îú‚îÄ Quartz Scheduler
    ‚îÇ   ‚îî‚îÄ ScanJobRepository
    ‚îî‚îÄ ScannerJob (QuartzJobBean)
        ‚îú‚îÄ DirectoryScanner
        ‚îú‚îÄ QueueManager
        ‚îî‚îÄ Repositories

Repository Layer (JPA)
    ‚îú‚îÄ ScanJobRepository
    ‚îú‚îÄ ScanJobExecutionRepository
    ‚îî‚îÄ ScannedFileRepository
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (application.yml)

```yaml
scanner:
  instance-id: ${HOSTNAME:scanner-1}  # ID –∏–Ω—Å—Ç–∞–Ω—Å–∞
  scan:
    default-timeout: 5m               # –¢–∞–π–º–∞—É—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    max-concurrent-scans: 3           # –ú–∞–∫—Å. –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–∫–∞–Ω–æ–≤
    file-size-limit: 1024MB           # –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
  queue:
    batch-size: 100                   # –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è –æ—á–µ—Ä–µ–¥–∏
    lock-timeout: 5m                  # –¢–∞–π–º–∞—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    cleanup-interval: 1h              # –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—á–∏—Å—Ç–∫–∏
  metrics:
    enabled: true                     # –í–∫–ª—é—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
    collection-interval: 30s          # –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞

spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/tia_etl
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
  
  data.redis:
    host: localhost
    port: 6379
    lettuce.pool:
      max-active: 10
      max-idle: 5
  
  quartz:
    job-store-type: jdbc              # –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤ –ë–î
    properties:
      org.quartz:
        scheduler:
          instanceId: AUTO
          instanceName: FileScannerScheduler
        jobStore:
          isClustered: true            # –ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º
        threadPool:
          threadCount: 10
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
src/test/kotlin/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ DirectoryScannerTest      # Unit —Ç–µ—Å—Ç—ã —Å–∫–∞–Ω–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ QueueManagerTest           # Unit —Ç–µ—Å—Ç—ã –æ—á–µ—Ä–µ–¥–∏
‚îÇ   ‚îî‚îÄ‚îÄ FileValidatorTest          # Unit —Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ ScanJobControllerTest      # MockMvc —Ç–µ—Å—Ç—ã API
‚îÇ   ‚îú‚îÄ‚îÄ FileStatusControllerTest   # MockMvc —Ç–µ—Å—Ç—ã API
‚îÇ   ‚îî‚îÄ‚îÄ MetricsControllerTest      # MockMvc —Ç–µ—Å—Ç—ã API
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ ScanJobServiceTest         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ FileStatusServiceTest      # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îú‚îÄ‚îÄ BaseIntegrationTest        # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚îÇ   ‚îú‚îÄ‚îÄ RedisQueueIntegrationTest  # Redis –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ ScanJobRepositoryIntegrationTest # JPA —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ e2e/
‚îÇ   ‚îú‚îÄ‚îÄ BaseE2ETest                # Testcontainers –±–∞–∑–∞
‚îÇ   ‚îú‚îÄ‚îÄ JobControllerE2ETest       # E2E —Ç–µ—Å—Ç—ã –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ FileOperationsE2ETest      # E2E —Ç–µ—Å—Ç—ã —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ MetricsE2ETest             # E2E —Ç–µ—Å—Ç—ã –º–µ—Ç—Ä–∏–∫
‚îî‚îÄ‚îÄ config/
    ‚îú‚îÄ‚îÄ TestConfiguration          # –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ TestQuartzConfig           # Mock Quartz
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏

- **unit** - —Ç–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **integration** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å Testcontainers
- **e2e** - end-to-end —Ç–µ—Å—Ç—ã
- **all** - –≤—Å–µ —Ç–µ—Å—Ç—ã

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

- Unit —Ç–µ—Å—Ç—ã: ~80% –ø–æ–∫—Ä—ã—Ç–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã: Redis, PostgreSQL —á–µ—Ä–µ–∑ Testcontainers
- E2E —Ç–µ—Å—Ç—ã: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã: ArchUnit –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## üöÄ Deployment –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **JVM**: Java 21+
- **–ü–∞–º—è—Ç—å**: –º–∏–Ω–∏–º—É–º 2GB heap
- **CPU**: 2+ —è–¥—Ä–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- **PostgreSQL**: –≤–µ—Ä—Å–∏—è 14+
- **Redis**: –≤–µ—Ä—Å–∏—è 6+

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_HOST=postgresql-server
DB_PORT=5432
DB_NAME=tia_etl
DB_USER=tia_user
DB_PASSWORD=secure_password

# Redis
REDIS_HOST=redis-server
REDIS_PORT=6379

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
SCANNER_INSTANCE_ID=scanner-prod-1
SCANNER_MAX_CONCURRENT_SCANS=5
SCANNER_FILE_SIZE_LIMIT=2048MB

# –ú–µ—Ç—Ä–∏–∫–∏
METRICS_ENABLED=true
METRICS_COLLECTION_INTERVAL=30s
```

### Health Checks

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç health endpoints –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

- `/api/v1/scanner/health` - –∫–∞—Å—Ç–æ–º–Ω—ã–π health check
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ QueueManager —Å—Ç–∞—Ç—É—Å–∞
  
- `/file-scanner/actuator/health` - Spring Boot health
  - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
  - Liveness –∏ Readiness probes

### –ú–µ—Ç—Ä–∏–∫–∏ Prometheus

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- `scanner_files_scanned_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- `scanner_files_queued_total` - —Ñ–∞–π–ª–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å
- `scanner_errors_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- `scanner_scan_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `scanner_queue_depth` - —Ç–µ–∫—É—â–∞—è –≥–ª—É–±–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏
- `scanner_processing_duration_seconds` - –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—Ä–æ–≤–Ω—è–º–∏:
- **DEBUG**: –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- **INFO**: –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã
- **WARN**: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ retry –æ–ø–µ—Ä–∞—Ü–∏–∏
- **ERROR**: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

–†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 10MB
- –ò—Å—Ç–æ—Ä–∏—è: 30 –¥–Ω–µ–π
- –ü—É—Ç—å: `/logs/file-scanner.log`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Keycloak (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- –†–æ–ª–∏: Admin, Operator, Viewer
- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è API –¥–æ—Å—Ç—É–ø–∞

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

- SHA-256 —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race conditions
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- SQL injection –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ JPA/Hibernate

### –ê—É–¥–∏—Ç

- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ–∑–¥–∞–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ createdBy/updatedBy
- –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –≤ –ë–î

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å sharding –¥–ª—è Redis –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

2. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**
   - –î–æ–±–∞–≤–∏—Ç—å circuit breaker –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å graceful shutdown —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á
   - –£–ª—É—á—à–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º —Å exponential backoff

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ OpenTelemetry
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫
   - –î–æ–±–∞–≤–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã Grafana

4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
   - –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö—ç—à–µ–π –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Keycloak
   - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ sensitive –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
   - Rate limiting –¥–ª—è API endpoints

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
- **Repository Pattern** - –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- **Service Layer** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
- **DTO Pattern** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ domain –∏ transfer –æ–±—ä–µ–∫—Ç–æ–≤
- **Dependency Injection** - —á–µ—Ä–µ–∑ Spring IoC container
- **Strategy Pattern** - –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ (CRON/FIXED)
- **Observer Pattern** - —á–µ—Ä–µ–∑ Spring Events (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

File Scanner Service –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SOLID –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º Spring Boot. –°–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.

–û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ª–æ–µ–≤
- Comprehensive —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API —á–µ—Ä–µ–∑ OpenAPI

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.
